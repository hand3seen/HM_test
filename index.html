<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Headmosh Zine Lab — Letter Grid (8.5×11)</title>
  <meta name="description" content="Make an 8‑panel zine on a precise 8.5×11 letter sheet. Locked panel ratio, drag‑and‑drop, copy‑paste images, bold B/W asset library, PNG export, and print‑ready layout.">
  <style>
    :root{ --ink:#111; --paper:#f7f5f1; --gap:10px; --panel-br:12px; }
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,"Helvetica Neue",Arial,sans-serif;color:var(--ink);background:var(--paper)}
    .app{display:grid;grid-template-columns:320px 1fr;min-height:100%}

    /* Sidebar */
    aside{border-right:2px solid #0002;padding:16px 14px;background:linear-gradient(#faf9f7,#f1efea)}
    h1{font-size:22px;margin:0 0 8px}
    .brand{font-weight:900;letter-spacing:1px}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .btn{display:inline-flex;align-items:center;gap:8px;border:2px solid #000;padding:8px 10px;border-radius:14px;background:#fff;cursor:pointer;font-weight:700;box-shadow:2px 2px 0 #000;transition:transform .05s}
    .btn:active{transform:translate(1px,1px);box-shadow:1px 1px 0 #000}
    .btn.block{width:100%;justify-content:center;margin:6px 0}
    .btn.ghost{background:transparent}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
    .card{border:2px solid #000;background:#fff;border-radius:16px;padding:12px;box-shadow:3px 3px 0 #000;margin:8px 0}
    .tiny{font-size:12px;opacity:.75}
    label.switch{display:flex;align-items:center;gap:8px;font-size:13px}

    /* Workspace */
    main{padding:18px}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin:4px 0 12px}
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--gap)}
    .panel{position:relative;border:2px solid #000;background:#fff;border-radius:var(--panel-br);box-shadow:3px 3px 0 #000;overflow:hidden;aspect-ratio:3/4;}
    .panel .hint{position:absolute;inset:8px auto auto 8px;font-size:11px;opacity:.5;background:#fff;padding:2px 6px;border-radius:100px;border:1px dashed #000}
    .panel .content{position:absolute;inset:0;padding:10px;white-space:pre-wrap}
    .panel img{max-width:100%;max-height:100%;object-fit:contain;display:block;margin:auto}
    .drop{position:absolute;inset:0;border:2px dashed #0005;border-radius:10px;display:none;place-items:center;background:#00000008}
    .panel.dragover .drop{display:grid}
    .panel.selected{outline:3px solid #000}

    .status{font-size:12px;opacity:.75;margin-left:auto}

    /* Asset library */
    .assets{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;max-height:180px;overflow:auto;margin-top:8px}
    .asset{border:2px solid #000;background:#fff;border-radius:10px;box-shadow:2px 2px 0 #000;display:grid;place-items:center;cursor:grab;height:56px}
    .asset img{max-width:80%;max-height:80%}

    /* LETTER PRINT SHEET (exact size) */
    #letterWrap{display:flex;justify-content:center}
    #letterSheet{width:8.5in;height:11in;background:#fff;border:2px solid #000;border-radius:10px;box-shadow:0 0 0 1px #0002 inset;display:grid;grid-template-columns:repeat(4,1fr);grid-template-rows:repeat(2,1fr);gap:0.2in;padding:0.35in;box-sizing:border-box}
    .printPanel{border:2px solid #000;border-radius:10px;overflow:hidden;position:relative}
    .printPanel .content{position:absolute;inset:0;padding:8px}
    .printPanel img{max-width:100%;max-height:100%;object-fit:contain;display:block;margin:auto}
    .bw img{filter:grayscale(100%) contrast(120%)}

    /* Subtle paper grain */
    body:before{content:"";position:fixed;inset:0;background:radial-gradient(circle at 10% 10%,#0001 0 1px,transparent 1px) 0 0/6px 6px,radial-gradient(circle at 70% 80%,#0001 0 1px,transparent 1px) 0 0/9px 9px;opacity:.18;pointer-events:none}

    @media print{
      .app, .toolbar, aside{display:none !important}
      body{background:#fff}
      #letterWrap{display:block}
      @page{size:letter;margin:0}
      #letterSheet{box-shadow:none;border:0}
    }
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <h1><span class="brand">HEADMOSH</span> <span class="mono">/ Letter Zine Lab</span></h1>
      <p class="tiny">Locked 8‑panel grid designed to print cleanly on <strong>8.5×11</strong>. Drag or paste images, add punk B/W assets, then fill the sheet and print or export PNG.</p>

      <div class="card">
        <strong>Actions</strong>
        <div class="row">
          <button class="btn block" id="promptBtn">Random prompt</button>
          <button class="btn block" id="shuffleBtn">Shuffle panels</button>
        </div>
        <div class="row">
          <button class="btn block" id="scribbleBtn">Add scribbles</button>
          <button class="btn block" id="clearScribbleBtn">Clear scribbles</button>
        </div>
        <div class="row">
          <button class="btn" id="exportPngBtn">Export Workspace PNG</button>
        </div>
      </div>

      <div class="card">
        <strong>Letter Sheet</strong>
        <div class="row">
          <button class="btn block" id="fillLetterBtn">Fill 8.5×11 sheet from panels</button>
          <button class="btn block" id="exportLetterBtn">Export Letter PNG</button>
          <button class="btn ghost" id="printBtn">Print</button>
        </div>
        <label class="switch"><input type="checkbox" id="bwToggle"> B/W print mode (grayscale, extra contrast)</label>
      </div>

      <div class="card">
        <strong>Asset Library (drag or click)</strong>
        <div class="assets" id="assetGrid"></div>
        <div class="row"><button class="btn block" id="randomAssetBtn">Add random B/W object to selected panel</button></div>
      </div>

      <div class="card">
        <strong>Project</strong>
        <div class="row">
          <button class="btn" id="saveBtn">Export JSON</button>
          <label class="btn" for="loadFile">Import JSON</label>
          <input id="loadFile" type="file" accept="application/json" style="display:none"/>
        </div>
      </div>

      <div class="card">
        <strong>Tips</strong>
        <ul class="tiny">
          <li>Click a panel to select it (outline shows).</li>
          <li>Paste images with <kbd>Ctrl/Cmd+V</kbd> directly into a panel.</li>
          <li>Drag assets into panels, or click a tile to insert.</li>
          <li>Panels are locked to a 3:4 ratio for consistent print composition.</li>
        </ul>
      </div>
    </aside>

    <main>
      <div class="toolbar"><div class="status" id="status">Ready.</div></div>
      <section id="workspace" class="grid" aria-label="Editable panels (1–8)"></section>

      <h3 style="margin:18px 0 6px">Letter preview</h3>
      <div id="letterWrap">
        <section id="letterSheet" aria-label="8.5×11 Letter layout (4×2 grid)"></section>
      </div>
    </main>
  </div>

  <!-- html2canvas for PNG export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
  // Prompts
  const prompts = [
    "Draw your day using only triangles.",
    "Write three lines you’ll gladly throw away.",
    "Paste a photo and destroy half of it.",
    "Make a lake wave with only straight lines.",
    "Turn a mistake into the title.",
    "Interview an object on your desk in 4 panels.",
    "Blind contour your hand for 30s—no peeking.",
    "Cut, paste, repeat one word until it’s music.",
    "Draw Grimbo’s loud thought vs. Zapette’s calm reply.",
    "Permission slip: You are allowed to make something ugly."
  ];

  // Black & white SVG asset library
  const SVG_ASSETS = [
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><path d='M0 120 Q40 60 80 120 T160 120 T240 120' fill='none' stroke='black' stroke-width='18' stroke-linecap='round'/><path d='M110 120 q-10-25 15-45' fill='none' stroke='black' stroke-width='12' stroke-linecap='round'/></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><g stroke='black' stroke-width='16'><circle cx='100' cy='100' r='30' fill='white'/><g><path d='M100 8 V60'/><path d='M100 140 v52'/><path d='M8 100 H60'/><path d='M140 100 h52'/><path d='M30 30 L60 60'/><path d='M170 170 L140 140'/><path d='M30 170 L60 140'/><path d='M170 30 L140 60'/></g></g></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><g fill='black'>${Array.from({length:50},(_,i)=>{const x=(i%10)*20,y=Math.floor(i/10)*20;return (i+x/20+y/20)%2?`<rect x='${x}' y='${y}' width='20' height='20'/>`:''}).join('')}</g></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><g fill='none' stroke='black' stroke-width='18'><circle cx='90' cy='110' r='60'/><circle cx='90' cy='110' r='22'/><path d='M150 110 h40 v40' /></g></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><g fill='none' stroke='black' stroke-width='14' stroke-linecap='round'><circle cx='60' cy='70' r='26'/><circle cx='100' cy='50' r='26'/><path d='M80 110 L180 170'/><path d='M80 110 L180 40'/></g></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><path d='M20 100 H160' stroke='black' stroke-width='20'/><path d='M120 60 L180 100 120 140 Z' fill='black'/></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><path d='M40 120 a60 60 0 1 1 120 0' fill='none' stroke='black' stroke-width='18'/><rect x='30' y='110' width='30' height='60' fill='black'/><rect x='140' y='110' width='30' height='60' fill='black'/></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><path d='M20 40 h140 v80 h-60 l-20 20 v-20 h-60 z' fill='white' stroke='black' stroke-width='16'/></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 220 140'><rect width='100%' height='100%' fill='white'/><rect x='10' y='40' width='180' height='60' rx='6' fill='white' stroke='black' stroke-width='14'/><circle cx='50' cy='110' r='14' fill='black'/><circle cx='150' cy='110' r='14' fill='black'/><rect x='24' y='52' width='36' height='28' fill='black'/><rect x='66' y='52' width='36' height='28' fill='black'/><rect x='108' y='52' width='36' height='28' fill='black'/></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect width='100%' height='100%' fill='white'/><g fill='none' stroke='black' stroke-width='14' stroke-linecap='round'><path d='M100 180 V100'/><path d='M100 120 q-40 -30 -70 0'/><path d='M100 140 q40 -30 70 0'/><path d='M100 100 q-30 -40 -50 -20'/><path d='M100 100 q30 -40 50 -20'/></g></svg>`,
    () => `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><defs><pattern id='tri' width='20' height='20' patternUnits='userSpaceOnUse'><path d='M0 20 L10 0 L20 20 Z' fill='black'/></pattern></defs><rect width='100%' height='100%' fill='white'/><rect width='100%' height='100%' fill='url(#tri)'/></svg>`
  ];

  const $ = s => document.querySelector(s);
  const setStatus = t => $('#status').textContent = t;

  // Build 8 panels
  const workspace = $('#workspace');
  const panels = [];
  let selectedPanel = null;
  for(let i=1;i<=8;i++){
    const p = document.createElement('div'); p.className='panel'; p.dataset.index=i;
    const hint = document.createElement('div'); hint.className='hint'; hint.textContent='Page '+i;
    const content = document.createElement('div'); content.className='content'; content.contentEditable=true; content.setAttribute('role','textbox');
    const drop = document.createElement('div'); drop.className='drop'; drop.innerHTML='<div class="mono tiny">Drop image here</div>';

    ['dragenter','dragover'].forEach(evt=>p.addEventListener(evt,e=>{e.preventDefault();p.classList.add('dragover')}));
    ;['dragleave','drop'].forEach(evt=>p.addEventListener(evt,e=>{e.preventDefault();p.classList.remove('dragover')}));
    p.addEventListener('drop', async (e)=>{
      const file = [...e.dataTransfer.files][0];
      if(file && file.type.startsWith('image/')){ const img = await fileToImg(file); placeImage(p,img); }
      const url = e.dataTransfer.getData('text/uri-list'); if(url){ const im=new Image(); im.onload=()=>placeImage(p,im); im.src=url; }
    });

    p.addEventListener('paste', async (e)=>{ const item = [...e.clipboardData.items].find(i=>i.type.startsWith('image/')); if(item){ e.preventDefault(); const img = await fileToImg(item.getAsFile()); placeImage(p,img); }});

    p.addEventListener('click', ()=>{ panels.forEach(x=>x.classList.remove('selected')); p.classList.add('selected'); selectedPanel=p; });

    p.append(hint,content,drop); workspace.appendChild(p); panels.push(p);
  }

  function placeImage(panel,img){ const old=panel.querySelector('img'); if(old) old.remove(); img.draggable=false; panel.querySelector('.content').appendChild(img); }
  function fileToImg(file){ return new Promise(res=>{ const fr=new FileReader(); fr.onload=()=>{ const img=new Image(); img.onload=()=>res(img); img.src=fr.result; }; fr.readAsDataURL(file); }); }

  // Build asset grid
  const grid = document.getElementById('assetGrid');
  SVG_ASSETS.forEach(make=>{ const url='data:image/svg+xml;utf8,'+encodeURIComponent(make()); const tile=document.createElement('div'); tile.className='asset'; const img=new Image(); img.src=url; img.alt='asset'; tile.appendChild(img); tile.draggable=true; tile.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/uri-list', url); }); tile.addEventListener('click',()=>{ const target=selectedPanel||panels[Math.floor(Math.random()*panels.length)]; const im=new Image(); im.onload=()=>placeImage(target,im); im.src=url; }); grid.appendChild(tile); });

  // Buttons
  $('#promptBtn').addEventListener('click',()=>{ alert('PROMPT: '+prompts[Math.floor(Math.random()*prompts.length)]); });
  $('#shuffleBtn').addEventListener('click',()=>{ const order=[...panels]; order.sort(()=>Math.random()-0.5); order.forEach(p=>workspace.appendChild(p)); setStatus('Shuffled panel order.'); });

  let scribbleLayer; $('#scribbleBtn').addEventListener('click',()=>{ if(scribbleLayer) scribbleLayer.remove(); scribbleLayer=document.createElement('canvas'); scribbleLayer.className='scribble'; document.body.appendChild(scribbleLayer); const ctx=scribbleLayer.getContext('2d'); resizeScribble(); ctx.lineWidth=2; ctx.strokeStyle='#0003'; for(let i=0;i<120;i++){ ctx.beginPath(); ctx.moveTo(Math.random()*scribbleLayer.width,Math.random()*scribbleLayer.height); ctx.bezierCurveTo(Math.random()*scribbleLayer.width,Math.random()*scribbleLayer.height,Math.random()*scribbleLayer.width,Math.random()*scribbleLayer.height,Math.random()*scribbleLayer.width,Math.random()*scribbleLayer.height); ctx.stroke(); } setStatus('Added scribbles (overlay).'); });
  $('#clearScribbleBtn').addEventListener('click',()=>{ if(scribbleLayer){ scribbleLayer.remove(); scribbleLayer=null; setStatus('Cleared scribbles.'); } });
  window.addEventListener('resize',()=>scribbleLayer && resizeScribble()); function resizeScribble(){ scribbleLayer.width=innerWidth; scribbleLayer.height=innerHeight; }

  // Letter sheet logic
  const letter = $('#letterSheet');
  function fillLetter(){ letter.innerHTML=''; for(let i=0;i<8;i++){ const cell=document.createElement('div'); cell.className='printPanel'; const c=document.createElement('div'); c.className='content'; c.innerHTML = panels[i].querySelector('.content').innerHTML; cell.appendChild(c); letter.appendChild(cell); } setStatus('Filled 8.5×11 sheet from panels.'); }
  $('#fillLetterBtn').addEventListener('click', fillLetter);

  // B/W toggle
  $('#bwToggle').addEventListener('change', (e)=>{ letter.classList.toggle('bw', e.target.checked); });

  // Exports
  $('#exportPngBtn').addEventListener('click', async ()=>{ setStatus('Rendering workspace PNG…'); const canvas = await html2canvas(workspace, {backgroundColor:'#ffffff', scale:2}); const a=document.createElement('a'); a.download='headmosh-workspace.png'; a.href=canvas.toDataURL('image/png'); a.click(); setStatus('Workspace PNG exported.'); });
  $('#exportLetterBtn').addEventListener('click', async ()=>{ if(!letter.children.length) fillLetter(); setStatus('Rendering letter PNG…'); const canvas = await html2canvas(letter, {backgroundColor:'#ffffff', scale:3}); const a=document.createElement('a'); a.download='headmosh-letter-8x11.png'; a.href=canvas.toDataURL('image/png'); a.click(); setStatus('Letter PNG exported.'); });
  $('#printBtn').addEventListener('click', ()=>{ if(!letter.children.length) fillLetter(); window.print(); });

  // Project save/load
  $('#saveBtn').addEventListener('click',()=>{ const data = panels.map(p=>({ html:p.querySelector('.content').innerHTML })); const blob=new Blob([JSON.stringify({v:1,p:data},null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=Object.assign(document.createElement('a'),{href:url,download:'headmosh-letter-zine.json'}); a.click(); URL.revokeObjectURL(url); });
  $('#loadFile').addEventListener('change', async (e)=>{ const file=e.target.files[0]; if(!file) return; const text=await file.text(); const data=JSON.parse(text); data.p.forEach((pd,i)=>{ const p=panels[i]; p.querySelector('.content').innerHTML=pd.html; }); setStatus('Project loaded.'); });

  setStatus('Ready. Build in the 8 panels, then Fill 8.5×11 sheet → Export Letter PNG or Print.');
  </script>
</body>
</html>
